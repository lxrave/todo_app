# Спецификация: Приоритет задачи (редактируемый, сортировка, перетаскивание в группе)

**Ветка фичи**: `003-task-priority`  
**Создано**: 2026-02-17  
**Статус**: Черновик  
**Ввод**: К каждой задаче добавить редактируемое поле приоритет (редактирование по клику). Три уровня: Low, Medium, High. Список всегда отсортирован по приоритету. Перетаскивание задач разрешено только в рамках одного приоритета (задачу с приоритетом Low можно перемещать только среди задач с приоритетом Low).

## Уточнения

### Session 2026-02-17

- Q: Как пользователь выбирает приоритет после клика по полю приоритета? → A: Лёгкий выпадающий список, по аналогии со сменой приоритета в Jira.
- Q: При смене приоритета задачи куда в новой группе она должна встать? → A: В конец группы с новым приоритетом (Option B).
- Q: Когда пользователь пытается перетащить задачу в зону другого приоритета, что должно происходить в интерфейсе? → A: Перетаскивание визуально заблокировано: отпустить (drop) в зоне другой группы нельзя, drop не срабатывает (Option B).
- Q: Как визуально показывать группы приоритета в списке? → A: Карточки задач раскрашены в еле уловимый цвет по приоритету: Low — синий (blue), Medium — жёлтый (yellow), High — красный (red).

## Пользовательские сценарии и проверки *(обязательно)*

### User Story 1 — Отображение и редактирование приоритета по клику (Приоритет: P1)

Пользователь видит у каждой задачи отображаемый приоритет (Low, Medium или High). По клику на значение приоритета пользователь может изменить его на другой из трёх вариантов; изменение сразу отображается и сохраняется.

**Почему этот приоритет**: Без возможности задать и изменить приоритет остальные правила (сортировка, перетаскивание в группе) не имеют смысла.

**Независимая проверка**: Открыть приложение → добавить задачу → кликнуть по приоритету → выбрать другое значение → убедиться, что приоритет изменился и после перезагрузки сохранился.

**Сценарии приёмки**:

1. **Дано** задача в списке, **Когда** пользователь кликает по отображаемому приоритету, **Тогда** открывается лёгкий выпадающий список с тремя вариантами: Low, Medium, High (по аналогии со сменой приоритета в Jira).
2. **Дано** пользователь выбрал новый приоритет, **Когда** выбор подтверждён (или фокус снят), **Тогда** задача отображается с новым приоритетом и состояние сохраняется после перезагрузки.
3. **Дано** пользователь добавляет новую задачу, **Тогда** у задачи есть приоритет по умолчанию (например, Medium), отображаемый в списке.

---

### User Story 2 — Сортировка списка по приоритету (Приоритет: P1)

Список задач всегда упорядочен по приоритету: сначала задачи с более высоким приоритетом, затем с более низким. Порядок уровней: High выше Medium, Medium выше Low. Группы приоритета визуально выделены еле уловимым цветом карточки: High — красный (red), Medium — жёлтый (yellow), Low — синий (blue). Внутри одной группы порядок задач сохраняется (в том числе после перетаскивания).

**Почему этот приоритет**: Сортировка по приоритету — основная ценность фичи; пользователь сразу видит задачи в нужном порядке.

**Независимая проверка**: Иметь задачи с разными приоритетами → убедиться, что в списке сначала идут High, затем Medium, затем Low; изменить приоритет задачи → порядок списка обновился.

**Сценарии приёмки**:

1. **Дано** в списке есть задачи с приоритетами High, Low, Medium, **Когда** пользователь просматривает список, **Тогда** задачи отображаются в порядке: сначала все High, затем все Medium, затем все Low.
2. **Дано** пользователь изменил приоритет задачи с Low на High, **Тогда** эта задача перемещается в конец группы High и отображается выше групп Medium и Low.
3. **Дано** порядок задач внутри одной группы приоритета был изменён перетаскиванием, **Когда** пользователь перезагружает страницу, **Тогда** порядок внутри группы сохраняется.

---

### User Story 3 — Перетаскивание только в рамках одного приоритета (Приоритет: P2)

Пользователь может менять порядок задач перетаскиванием (мышь или тач), но только среди задач с одинаковым приоритетом. Задачу с приоритетом Low нельзя перетащить в группу Medium или High; задачу High — в группу Low или Medium.

**Почему этот приоритет**: Ограничение перетаскивания группой приоритета защищает согласованность сортировки и упрощает понимание интерфейса.

**Независимая проверка**: Иметь несколько задач с приоритетом Low и несколько с Medium → перетащить задачу Low вверх/вниз среди Low — порядок меняется; попытка перетащить задачу Low в зону Medium — задача остаётся в группе Low (или перетаскивание в другую группу недоступно).

**Сценарии приёмки**:

1. **Дано** в списке есть минимум две задачи с приоритетом Low, **Когда** пользователь перетаскивает одну из них выше или ниже другой задачи Low, **Тогда** порядок этих двух задач меняется и после перезагрузки сохраняется.
2. **Дано** задача с приоритетом Low и задача с приоритетом High, **Когда** пользователь пытается перетащить задачу Low в позицию между задачами High (или наоборот), **Тогда** отпустить элемент (drop) в зоне другой группы нельзя — перетаскивание визуально ограничено своей группой приоритета, порядок по приоритету не нарушается.
3. **Дано** пользователь изменил порядок задач внутри группы приоритета перетаскиванием, **Тогда** общий порядок списка по приоритету (High → Medium → Low) сохраняется.

---

### Граничные случаи

- Новая задача без явно указанного приоритета получает значение по умолчанию (например, Medium).
- При единственной задаче в группе приоритета перетаскивание не меняет порядок (или элемент остаётся на месте).
- Если отображаемое значение приоритета редактируется по клику: при отмене редактирования (например, клик вне поля или Escape) сохраняется предыдущее значение.

## Требования *(обязательно)*

### Функциональные требования

- **FR-001**: У каждой задачи должно быть поле приоритет с одним из трёх значений: Low, Medium, High.
- **FR-002**: Пользователь должен иметь возможность изменить приоритет задачи по клику на отображаемое значение приоритета: открывается лёгкий выпадающий список с вариантами Low, Medium, High (в стиле смены приоритета в Jira).
- **FR-003**: Список задач должен всегда отображаться отсортированным по приоритету: сначала High, затем Medium, затем Low; внутри одной группы приоритета — по пользовательскому порядку (порядок отображения сохраняется). Карточки задач выделяются еле уловимым цветом по приоритету: High — красный, Medium — жёлтый, Low — синий.
- **FR-004**: Перетаскивание задачи допускается только в пределах задач с тем же приоритетом. В зоне задач другого приоритета drop не срабатывает (перетаскивание визуально ограничено своей группой).
- **FR-005**: Значение приоритета (и порядок внутри группы) должно сохраняться после перезагрузки страницы (персистентность).
- **FR-006**: Новые задачи должны получать приоритет по умолчанию (в спецификации принят Medium, если не задано иное).
- **FR-007**: При смене приоритета задачи она должна помещаться в конец группы с новым приоритетом.

### Ключевые сущности

- **Задача (Task)**: помимо существующих полей (id, text, completed, order) появляется атрибут приоритет со значением из множества { Low, Medium, High }. Порядок отображения определяется сначала приоритетом, затем полем порядка внутри группы приоритета. При смене приоритета задача помещается в конец новой группы.
- **Список задач**: упорядоченная по приоритету (High → Medium → Low) последовательность задач; внутри каждой группы приоритета — свой порядок (order), изменяемый перетаскиванием только в рамках этой группы.

## Критерии успеха *(обязательно)*

### Измеримые результаты

- **SC-001**: Пользователь может изменить приоритет задачи не более чем за два действия (клик по приоритету, выбор значения).
- **SC-002**: Список всегда отображается в порядке приоритета (High, затем Medium, затем Low) без исключений.
- **SC-003**: Перетаскивание не приводит к появлению задачи одного приоритета среди задач другого приоритета.
- **SC-004**: После перезагрузки страницы приоритеты и порядок задач внутри каждой группы восстанавливаются.

## Допущения

- Существующее приложение Todo (список, добавление, переключение выполнения, перетаскивание) уже реализовано; фича расширяет модель задачи полем приоритет и правилами сортировки и перетаскивания.
- Порядок приоритетов для отображения: High выше Medium, Medium выше Low.
- Приоритет по умолчанию для новой задачи: Medium.
- Редактирование приоритета по клику: один клик открывает лёгкий выпадающий список с тремя вариантами (Low, Medium, High), по аналогии со сменой приоритета в Jira.
- При смене приоритета задачи она помещается в конец группы с новым приоритетом.
- При перетаскивании между группами приоритета: drop в зоне другой группы недоступен (визуальное ограничение), а не откат после drop.
- Визуальное выделение групп приоритета: карточки задач окрашены в еле уловимый цвет — High: красный (red), Medium: жёлтый (yellow), Low: синий (blue).
