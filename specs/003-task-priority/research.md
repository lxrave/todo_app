# Исследование: Приоритет задачи (003-task-priority)

**Дата**: 2026-02-17  
**Цель**: Закрепить технические решения для реализации приоритета, сортировки по приоритету и перетаскивания в рамках группы.

---

## 1. Модель данных и хранилище

**Decision**: Расширить существующую сущность Task полем `priority` со значением из множества `'Low' | 'Medium' | 'High'`. Хранить в том же localStorage (ключ `todo-app-tasks`); при загрузке записей без поля `priority` подставлять `'Medium'`.

**Rationale**: Один источник правды, обратная совместимость с уже сохранёнными задачами, соответствие FR-005 и FR-006.

**Alternatives considered**: Отдельная таблица/ключ для приоритетов (отклонено — усложняет синхронизацию); числовой приоритет 1–3 (отклонено — в спецификации явно Low/Medium/High).

---

## 2. Сортировка и порядок внутри группы

**Decision**: Порядок отображения: сначала сортировка по приоритету (фиксированный порядок High → Medium → Low), затем внутри каждой группы — по полю `order` (меньше = выше). Поле `order` глобальное в массиве; при смене приоритета задачи присваивать ей `order`, равный максимальному `order` в новой группе + 1 (т.е. в конец группы).

**Rationale**: Соответствует спецификации (FR-003, FR-007); одна числовая ось order упрощает персистентность и перетаскивание внутри группы.

**Alternatives considered**: Отдельный order per priority (например, orderHigh, orderMedium, orderLow) — возможен, но усложняет модель; один order с пересчётом при смене приоритета — выбран.

---

## 3. Перетаскивание только внутри группы приоритета

**Decision**: Рендерить список как три отдельные группы (High, Medium, Low); в каждой группе — свой экземпляр vue-draggable-next с общим `list`, привязанным к подмассиву задач этой группы. Таким образом, drop-зона физически ограничена своей группой: перетащить задачу в зону другой группы нельзя (Option B из уточнений).

**Rationale**: Sortable.js / vue-draggable-next не поддерживают «запрет drop между группами» в одном списке без кастомной логики; разделение на три списка по приоритету даёт нативное поведение «drop не срабатывает» вне своей зоны и соответствует FR-004.

**Alternatives considered**: Один список с фильтром по `move` (отклонять move, если target из другой группы) — возможен, но визуально пользователь мог бы «бросить» элемент между группами и потом откат; три группы с тремя draggable — выбран.

---

## 4. UI: выпадающий список приоритета и цвет карточки

**Decision**: В TaskItem: отображать текущий приоритет текстом (или бейджем); по клику открывать нативный `<select>` или кастомный лёгкий dropdown с тремя опциями (Low, Medium, High). Закрытие по выбору или клику вне / Escape без смены — сохранять предыдущее значение. Цвет карточки: задавать через CSS-класс (например, `.priority-high`, `.priority-medium`, `.priority-low`) с еле уловимым фоновым цветом (red, yellow, blue в пастельных/приглушённых тонах).

**Rationale**: Лёгкий dropdown соответствует уточнению (Jira-like); классы по приоритету упрощают тесты и доступность; цвета в спецификации зафиксированы (High — red, Medium — yellow, Low — blue), оттенки — на этапе реализации (e.g. rgba с низкой непрозрачностью).

**Alternatives considered**: Цикл по клику (отклонено — в уточнениях выбран явный выбор); отдельные компоненты для каждой группы с разным цветом контейнера (приемлемо, но цвет логичнее на карточке TaskItem).

---

## 5. Валидация и граничные случаи

**Decision**: При загрузке из localStorage: если у задачи поле `priority` отсутствует или не из множества { 'Low', 'Medium', 'High' }, считать `priority = 'Medium'`. При вызове `setPriority(id, value)` проверять value; при невалидном — no-op. Отмена редактирования приоритета (клик вне, Escape) — не вызывать setPriority, оставить прежнее значение.

**Rationale**: Соответствует конституции (устойчивость к ошибкам, валидация) и граничным случаям из спецификации.

**Alternatives considered**: Жёстко падать при невалидном priority (отклонено — риск потери данных при порче хранилища).
