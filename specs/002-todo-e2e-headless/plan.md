# План реализации: Автоматическая проверка Todo App (E2E в headless-браузере)

**Ветка**: `002-todo-e2e-headless` | **Дата**: 2026-02-16 | **Спецификация**: [spec.md](./spec.md)  
**Ввод**: Спецификация фичи из `specs/002-todo-e2e-headless/spec.md`.

## Summary

Ввести набор автоматических E2E-проверок Todo App, выполняемых в headless-браузере: добавление задачи, переключение статуса, удаление (при наличии в приложении), сохранение в localStorage (проверка после перезагрузки). Стек проверок: TypeScript, Playwright; запуск без ручного вмешательства (CI/локально). Проверяемое приложение — существующее Todo App (Vue 3, Vite); тесты поднимают приложение или подключаются к уже запущенному URL.

## Technical Context

**Language/Version**: TypeScript 5.x (как в проекте)  
**Primary Dependencies**: Playwright (e2e), существующие Vue 3, Vite, Pinia (приложение под тестами)  
**Storage**: Тесты не хранят данные; проверяют приложение, использующее localStorage (ключ `todo-app-tasks`)  
**Testing**: Vitest (unit) — без изменений; Playwright Test (e2e) — новый прогон  
**Target Platform**: Headless Chromium (по умолчанию); опционально Firefox/WebKit  
**Project Type**: single (тот же репозиторий; добавляется каталог e2e/ или tests/e2e/)  
**Performance Goals**: Полный прогон E2E завершается в разумное время (порядка минуты); стабильность важнее скорости  
**Constraints**: Запуск без GUI; изолированное состояние localStorage при необходимости (очистка до/после сценария); сценарий удаления — опционален до появления функции удаления в приложении  
**Scale/Scope**: 4 сценария (добавление, переключение, удаление*, персистентность); один тестовый прогон

## Проверка соответствия конституции

*Шлюз: пройти до фазы 0 (исследование). Повторить после фазы 1 (дизайн).*

Проверка по `.specify/memory/constitution.md`:

- **Чистый и поддерживаемый код**: Структура e2e-тестов и именование (сценарии, селекторы, page objects) соответствуют соглашениям проекта.
- **Тестируемость и код-ревью**: E2E-сценарии тестируемы и воспроизводимы; в ревью проверяется соответствие конституции.
- **Интуитивный и минималистичный UX**: Фича не меняет UX приложения; добавляется только инфраструктура проверок.
- **Расширяемость**: Добавление новых E2E-сценариев не ломает существующие; изоляция по сценариям (очистка состояния при необходимости).
- **Целостность данных**: Тесты проверяют сохранность данных (персистентность); не портят продовые данные (тесты работают с локальным/тестовым экземпляром приложения).
- **Устойчивость к ошибкам и валидация**: Ошибки в тестах (таймауты, отсутствие элементов) обрабатываются явно; при падении сценария результат однозначен (упавший тест).
- **Стандарты качества кода**: E2E-код следует стилю и структуре проекта (TypeScript, те же правила линта).

Отступлений нет; блок «Отслеживание сложности» пуст.

## Project Structure

### Documentation (эта фича)

```text
specs/002-todo-e2e-headless/
├── plan.md              # Этот файл
├── research.md          # Фаза 0: выбор E2E-фреймворка, практики
├── data-model.md        # Фаза 1: сущности сценариев и состояния приложения
├── quickstart.md        # Фаза 1: как запускать E2E
├── contracts/           # Фаза 1: контракт селекторов/страниц для E2E
└── tasks.md             # Фаза 2 (/speckit.tasks — создаётся отдельно)
```

### Source Code (корень репозитория)

Существующая структура сохраняется. Добавляется:

```text
tests/
├── unit/                # существующие юнит-тесты (Vitest)
│   ├── components/
│   └── stores/
└── e2e/                 # E2E-сценарии (Playwright)
    ├── fixtures/        # при необходимости (base URL, auth)
    ├── todo-add.spec.ts
    ├── todo-toggle.spec.ts
    ├── todo-delete.spec.ts   # опционально до реализации удаления
    ├── todo-persistence.spec.ts
    └── page-objects/    # при необходимости: главная страница, форма, список
         └── todo-app.ts

# Конфигурация Playwright в корне
playwright.config.ts
```

**Structure Decision**: Один репозиторий; E2E в `tests/e2e/`; конфиг Playwright в корне. Соответствует single-project и не дублирует unit-тесты.

## Complexity Tracking

Пусто (нарушений конституции нет).
