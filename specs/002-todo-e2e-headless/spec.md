# Спецификация: Автоматическая проверка Todo App (E2E в headless-браузере)

**Ветка фичи**: `002-todo-e2e-headless`  
**Создано**: 2026-02-16  
**Статус**: Черновик  
**Ввод**: Создать автоматическую проверку Todo App: добавление, удаление, переключение задач, сохранение в localStorage, с использованием headless-браузера.

## Пользовательские сценарии и проверки *(обязательно)*

### User Story 1 — Автоматическая проверка добавления задачи (Приоритет: P1)

Автоматический сценарий открывает приложение в headless-браузере, вводит текст задачи и подтверждает добавление. Проверка фиксирует, что задача появилась в списке на экране.

**Почему этот приоритет**: Добавление задачи — базовое действие; без его автоматической проверки регрессии остаются незамеченными.

**Независимая проверка**: Запустить набор автоматических проверок → сценарий «добавление» выполняется без ручного вмешательства → по итогу зафиксировано появление задачи в UI. Ценность: команда убеждается, что добавление работает после изменений кода.

**Сценарии приёмки**:

1. **Дано** запущенная автоматическая проверка в headless-браузере, **Когда** сценарий вводит текст и инициирует добавление задачи, **Тогда** в интерфейсе списка появляется элемент с введённым текстом.
2. **Дано** пустой список в приложении, **Когда** сценарий добавляет одну задачу, **Тогда** проверка успешно завершается (задача видна в DOM/на экране).

---

### User Story 2 — Автоматическая проверка переключения статуса задачи (Приоритет: P1)

Автоматический сценарий добавляет задачу (или использует уже существующую), переключает её статус «выполнена / не выполнена» через UI (например, чекбокс или клик по задаче) и проверяет, что отображение статуса изменилось.

**Почему этот приоритет**: Переключение выполнения — ключевая функция; автоматическая проверка защищает от регрессий при доработках.

**Независимая проверка**: Запустить сценарий переключения → без ручных действий проверка подтверждает смену отображения статуса задачи. Ценность: уверенность в работе отметки выполнения.

**Сценарии приёмки**:

1. **Дано** задача в статусе «не выполнена» в UI, **Когда** сценарий инициирует переключение (чекбокс/клик), **Тогда** проверка фиксирует, что задача отображается как выполненная.
2. **Дано** задача в статусе «выполнена», **Когда** сценарий переключает её обратно, **Тогда** проверка фиксирует отображение как не выполненная.

---

### User Story 3 — Автоматическая проверка удаления задачи (Приоритет: P2)

Автоматический сценарий создаёт задачу (или использует существующую), инициирует её удаление через предусмотренный в приложении механизм и проверяет, что задача исчезла из списка на экране.

**Почему этот приоритет**: Удаление важно для полноты сценариев использования; проверка выполняется после реализации удаления в приложении.

**Независимая проверка**: Запустить сценарий удаления → проверка подтверждает отсутствие удалённой задачи в UI. Ценность: регрессии удаления обнаруживаются автоматически.

**Сценарии приёмки**:

1. **Дано** в списке есть хотя бы одна задача, **Когда** сценарий выполняет действие удаления для этой задачи, **Тогда** эта задача больше не отображается в списке.
2. **Дано** несколько задач, **Когда** сценарий удаляет одну выбранную задачу, **Тогда** остальные задачи по-прежнему отображаются.

---

### User Story 4 — Автоматическая проверка сохранения в localStorage (Приоритет: P1)

Автоматический сценарий добавляет или меняет задачи (добавление, переключение статуса, при наличии — удаление), затем инициирует перезагрузку страницы (или повторное открытие приложения) и проверяет, что состояние списка сохранилось (те же задачи и статусы).

**Почему этот приоритет**: Без проверки персистентности нельзя гарантировать, что данные не теряются после перезагрузки.

**Независимая проверка**: Запустить сценарий «персистентность» → после действий над задачами и перезагрузки проверка подтверждает соответствие состояния списка ожидаемому. Ценность: уверенность в сохранении данных в localStorage.

**Сценарии приёмки**:

1. **Дано** сценарий добавил задачу и сохранил состояние, **Когда** выполняется перезагрузка страницы (или повторный переход на приложение), **Тогда** проверка фиксирует наличие этой задачи в списке.
2. **Дано** сценарий переключил задачу в «выполнена», **Когда** выполняется перезагрузка, **Тогда** проверка фиксирует, что задача по-прежнему отображается как выполненная.
3. **Дано** приложение поддерживает удаление и сценарий удалил задачу, **Когда** выполняется перезагрузка, **Тогда** проверка фиксирует, что удалённая задача не появляется в списке.

---

### Граничные случаи

- Что считается успешным прохождением проверки при пустом начальном состоянии приложения (очищенный localStorage)?
- Как проверка ведёт себя при недоступности или отключённом localStorage (например, в изолированной среде)?
- Как обрабатывается ситуация, когда в приложении ещё не реализовано удаление задач: сценарий удаления пропускается или помечается как ожидающий реализации.

## Требования *(обязательно)*

### Функциональные требования

- **FR-001**: Набор автоматических проверок ДОЛЖЕН выполняться в среде headless-браузера (без отображаемого окна браузера).
- **FR-002**: Автоматическая проверка ДОЛЖНА покрывать сценарий добавления задачи и подтверждать появление задачи в пользовательском интерфейсе.
- **FR-003**: Автоматическая проверка ДОЛЖНА покрывать сценарий переключения статуса задачи (выполнена / не выполнена) и подтверждать изменение отображения.
- **FR-004**: Автоматическая проверка ДОЛЖНА покрывать сценарий удаления задачи и подтверждать исчезновение задачи из списка (при условии, что в приложении реализовано удаление).
- **FR-005**: Автоматическая проверка ДОЛЖНА проверять сохранение данных: после добавления и/или переключения статуса (и при наличии — удаления) перезагрузка страницы не должна приводить к потере ожидаемого состояния списка (персистентность через localStorage).
- **FR-006**: Проверки ДОЛЖНЫ запускаться без ручного вмешательства пользователя (один запуск выполняет все предусмотренные сценарии или выбранное подмножество).

### Ключевые сущности

- **Сценарий проверки**: логическая единица автоматической проверки (например, «добавление», «переключение», «удаление», «персистентность»); выполняется в headless-браузере и даёт результат «успех» или «ошибка».
- **Состояние приложения**: список задач и их атрибуты (текст, статус выполнения), отображаемые в UI и при необходимости проверяемые после перезагрузки.

## Критерии успеха *(обязательно)*

### Измеримые результаты

- **SC-001**: Все определённые автоматические проверки (добавление, переключение, персистентность, при наличии — удаление) завершаются с результатом «успех» при запуске в headless-браузере на корректно работающем приложении.
- **SC-002**: Полный набор проверок выполняется за один запуск (или за один явно заданный набор команд) без необходимости ручных действий между сценариями.
- **SC-003**: Ответственное лицо (разработчик или тестировщик) может подтвердить, что поведение Todo App проверено автоматически, запустив предусмотренный набор проверок и получив однозначный результат (все пройдены / список упавших сценариев).

## Допущения

- Проверяемое приложение — Todo App из контекста проекта (список задач, добавление, переключение статуса, при наличии — удаление).
- Хранение данных реализовано через localStorage; проверка персистентности опирается на повторную загрузку страницы и сравнение состояния списка.
- Если удаление в приложении ещё не реализовано, сценарий удаления может быть помечен как ожидающий или пропущен до появления функции удаления; остальные проверки остаются обязательными.
