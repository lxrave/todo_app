# Задачи: Автоматическая проверка Todo App (E2E в headless-браузере)

**Входные артефакты**: документы из `specs/002-todo-e2e-headless/`  
**Необходимо иметь**: plan.md, spec.md, research.md, data-model.md, contracts/e2e-selectors.md, quickstart.md

**Объект проверки (не входит в эти задачи)**  
Проверяемое приложение — **Todo App** (Vue 3, Vite, Pinia). Его разработка и доработки относятся к другой спецификации или уже реализованы. В рамках 002 мы только добавляем автоматические E2E-сценарии (Playwright): тесты открывают приложение в headless-браузере и проверяют сценарии из spec.md. Изменения кода приложения в этом документе не планируются — только инфраструктура тестов и сами тесты.

**Организация**: Задачи сгруппированы по пользовательским историям; каждую историю можно проверять отдельно (запуск соответствующего spec-файла).

## Формат: `[ID] [P?] [Story] Описание`

- **[P]**: Можно выполнять параллельно (разные файлы, нет зависимостей)
- **[Story]**: Номер пользовательской истории (US1–US4)
- В описаниях указывать точные пути к файлам

## Соглашения по путям

- E2E-спеки: `tests/e2e/*.spec.ts`
- Page object: `tests/e2e/page-objects/todo-app.ts`
- Конфиг: `playwright.config.ts` (корень репозитория)

---

## Фаза 1: Настройка (общая инфраструктура)

**Цель**: Установка Playwright и структура каталогов для E2E

- [x] T001 Создать структуру каталогов: tests/e2e/ и tests/e2e/page-objects/ согласно plan.md
- [x] T002 Добавить Playwright в devDependency, создать playwright.config.ts в корне репозитория (webServer для Vite dev server, baseURL, headless: true) и добавить npm-скрипт "test:e2e": "playwright test" в package.json
- [x] T003 Выполнить `npx playwright install chromium` (или описать в README), чтобы E2E могли запускаться в headless

---

## Фаза 2: Основа (блокирующие предварительные условия)

**Цель**: Page object и селекторы, необходимые всем E2E-спекам (согласно contracts/e2e-selectors.md)

**⚠️ КРИТИЧНО**: Ни один spec пользовательской истории нельзя реализовать, пока эта фаза не завершена

- [x] T004 Создать page object tests/e2e/page-objects/todo-app.ts с локаторами: поле ввода формы (placeholder «Текст задачи»), кнопка «Добавить», список/элементы списка, чекбоксы; методы добавления задачи, получения задачи по тексту, переключения по тексту (согласно contracts/e2e-selectors.md)

**Контрольная точка**: Page object готов — можно реализовывать E2E-сценарии

---

## Фаза 3: Пользовательская история 1 — Добавление задачи (Приоритет: P1) — MVP

**Цель**: E2E-сценарий проходит: открыть приложение, ввести текст задачи, нажать «Добавить», задача появляется в списке (FR-002).

**Независимая проверка**: Запуск `npx playwright test tests/e2e/todo-add.spec.ts` — все тесты проходят в headless.

- [x] T005 [P] [US1] Реализовать E2E-сценарий в tests/e2e/todo-add.spec.ts: открыть baseURL, ввести текст задачи в поле, нажать «Добавить», проверить, что задача с этим текстом появилась в списке (случаи пустого и непустого списка по сценариям приёмки)

**Контрольная точка**: Пользовательская история 1 проверяется отдельно через todo-add.spec.ts

---

## Фаза 4: Пользовательская история 2 — Переключение статуса задачи (Приоритет: P1)

**Цель**: E2E-сценарий проходит: добавить или использовать существующую задачу, переключить выполнение через чекбокс/клик, проверить отображение в UI «выполнена» / «не выполнена» (FR-003).

**Независимая проверка**: Запуск `npx playwright test tests/e2e/todo-toggle.spec.ts` — все тесты проходят в headless.

- [x] T006 [P] [US2] Реализовать E2E-сценарий в tests/e2e/todo-toggle.spec.ts: обеспечить наличие одной задачи, нажать чекбокс (или строку задачи), проверить, что задача отображается как выполненная; переключить снова и проверить «не выполнена» (согласно contracts/e2e-selectors.md)

**Контрольная точка**: Пользовательские истории 1 и 2 проверяются отдельно

---

## Фаза 5: Пользовательская история 3 — Удаление задачи (Приоритет: P2)

**Цель**: E2E-сценарий удаления при поддержке в приложении; иначе — пропуск (FR-004, research: пропуск до появления удаления в приложении).

**Независимая проверка**: Запуск `npx playwright test tests/e2e/todo-delete.spec.ts` — тесты пропускаются или проходят в зависимости от возможностей приложения.

- [x] T007 [P] [US3] Добавить tests/e2e/todo-delete.spec.ts: реализовать сценарий удаления (добавить задачу, выполнить удаление, проверить исчезновение из списка) либо пометить тест как test.skip с комментарием «Включить, когда в Todo App будет реализовано удаление» согласно research.md

**Контрольная точка**: Сценарий удаления присутствует; пропуск до поддержки удаления в приложении

---

## Фаза 6: Пользовательская история 4 — Сохранение в localStorage (Приоритет: P1)

**Цель**: E2E-сценарий проходит: добавить/переключить задачи, перезагрузить страницу, проверить сохранение состояния списка (FR-005).

**Независимая проверка**: Запуск `npx playwright test tests/e2e/todo-persistence.spec.ts` — все тесты проходят в headless.

- [x] T008 [P] [US4] Реализовать E2E-сценарий в tests/e2e/todo-persistence.spec.ts: добавить задачу, перезагрузить страницу, проверить, что задача осталась в списке; добавить задачу и переключить в «выполнена», перезагрузить, проверить, что задача на месте и отображается как выполненная (согласно quickstart и data-model)

**Контрольная точка**: Все четыре сценария (добавление, переключение, удаление*, персистентность) реализованы; полный набор можно запускать

---

## Фаза 7: Доработка и общее

**Цель**: Документация и валидация

- [x] T009 Обновить README в корне репозитория: добавить раздел про E2E (команда `npm run test:e2e`, ссылка на specs/002-todo-e2e-headless/quickstart.md)
- [x] T010 Запустить полный E2E-набор (`npm run test:e2e`) и проверить шаги из quickstart.md; убедиться, что в .gitignore включены test-results/ и playwright-report/ при их генерации

---

## Зависимости и порядок выполнения

### Зависимости фаз

- **Фаза 1 (Настройка)**: Зависимостей нет — начинать сразу
- **Фаза 2 (Основа)**: Зависит от фазы 1 — блокирует все спеки пользовательских историй
- **Фазы 3–6 (US1–US4)**: Зависят от фазы 2 (page object); спеки можно реализовывать параллельно (разные файлы)
- **Фаза 7 (Доработка)**: Зависит от завершения фаз 3–6

### Зависимости пользовательских историй

- **US1**: После T004 — не зависит от других историй
- **US2**: После T004 — тот же page object; можно использовать addTask из page object
- **US3**: После T004 — опционально; пропуск, если в приложении нет удаления
- **US4**: После T004 — добавление/переключение и перезагрузка; не зависит от US3

### Возможности параллельного выполнения

- T005, T006, T007, T008 (спеки для US1–US4) можно реализовывать параллельно после T004
- Порядок в одном файле: T001 → T002 → T003; T004 использует каталоги из T001

---

## Стратегия реализации

### Сначала MVP (пользовательская история 1)

1. Выполнить фазу 1 (Настройка) и фазу 2 (Основа)
2. Выполнить фазу 3 (todo-add.spec.ts)
3. Запустить `npm run test:e2e` с фильтром по todo-add — проверить сценарий добавления
4. Затем добавить фазу 4 (переключение), фазу 6 (персистентность), фазу 5 (пропуск удаления), фазу 7 (документация)

### Полный набор

1. Фаза 1 → Фаза 2 → Фазы 3, 4, 5, 6 (спеки в любом порядке) → Фаза 7
2. Одна команда `npm run test:e2e` запускает все E2E-сценарии в headless (FR-006, SC-002)

---

## Примечания

- [P] у задач-спеков: разные файлы (todo-add, todo-toggle, todo-delete, todo-persistence.spec.ts)
- [Story] связывает задачу с пользовательской историей из spec.md для прослеживаемости
- Сценарий удаления (US3): реализовать с test.skip до появления UI удаления в Todo App
- В конфиге Playwright должен запускаться Vite через webServer, чтобы тесты шли без ручного `npm run dev` (research.md)
