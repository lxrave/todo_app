# Исследование: E2E headless для Todo App

## 1. Выбор E2E-фреймворка

**Решение**: Playwright (Playwright Test).

**Обоснование**:
- Требование спецификации — выполнение в headless-браузере; Playwright по умолчанию запускает браузер в headless.
- Поддержка TypeScript из коробки; проект уже на TypeScript.
- Встроенное автоожидание (auto-wait) удобно для Vue-приложений с асинхронным обновлением DOM.
- Один прогон может охватывать Chromium, при необходимости — Firefox и WebKit.
- Отдельный тест-раннер и API для навигации, кликов, заполнения форм, проверки localStorage — без доп. библиотек для ассертов.
- Хорошая документация и практики для Vue-приложений.

**Рассмотренные альтернативы**:
- **Cypress**: Удобный DX, но выполнение «внутри» браузера; мульти-вкладки и часть сценариев с перезагрузкой страницы сложнее; для headless и простых сценариев с reload — Playwright предпочтительнее.
- **Puppeteer**: Только Chromium; нет встроенного тест-раннера и ассертов — пришлось бы добавлять (например, Vitest + playwright или jest-puppeteer). Playwright даёт единый стек (запуск браузера + тесты + ассерты).

## 2. Запуск приложения под тестами

**Решение**: Запуск dev-сервера (Vite) перед прогоном E2E через `webServer` в `playwright.config.ts`; базовый URL — `http://localhost:5173` (или динамический порт). Альтернатива — ручной запуск `npm run dev` и указание `BASE_URL`; для CI и однокомандного запуска предпочтителен `webServer`.

**Практика**: Использовать `reuseExistingServer: true` в dev, чтобы не поднимать второй сервер при уже запущенном `npm run dev`.

## 3. Изоляция состояния (localStorage)

**Решение**: При необходимости изолировать сценарии — очищать localStorage перед сценарием (или перед группой) через `page.goto()` + `page.evaluate(() => localStorage.clear())` или контекст с чистым storage. Для сценария персистентности — явно задавать начальное состояние (добавить задачу, перезагрузить, проверить), не полагаться на «мусор» от других тестов.

**Практика**: Сценарии добавления/переключения/удаления могут начинаться с пустого или предсказуемого состояния; сценарий персистентности — сам добавляет данные и проверяет после reload.

## 4. Селекторы и устойчивость

**Решение**: Использовать стабильные селекторы: по роли и тексту (например, `getByRole('textbox', { name: ... })`, `getByRole('button', { name: 'Добавить' })`), по тестовым id при необходимости. Избегать хрупких CSS-селекторов на внутренние классы компонентов. Для списка задач — искать по тексту задачи или по роли list/listitem.

**Практика**: Вынести селекторы и короткие сценарии «страницы» в page object (`tests/e2e/page-objects/todo-app.ts`) для повторного использования и упрощения поддержки.

## 5. Сценарий удаления

**Решение**: Реализовать E2E-сценарий удаления только после появления функции удаления в приложении (или помечать тест как skip до этого момента). В плане и задачах явно указать зависимость от фичи удаления в Todo App.

## Итог

- **E2E-стек**: Playwright (Playwright Test), TypeScript.
- **Запуск приложения**: `webServer` в конфиге Playwright (Vite dev).
- **Состояние**: При необходимости — очистка localStorage в начале сценария; персистентность проверять явным сценарием с reload.
- **Селекторы**: Роли и доступные имена; при необходимости — page object.
- **Удаление**: Сценарий добавляется/включается после реализации удаления в приложении.
